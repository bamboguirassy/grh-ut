<div class="add-action-box" *ngIf="structureFonctionSrv.resourceName|creable">
  <button tc-button [afterIcon]="'icofont-plus'" [view]="'accent'" [square]="true" [tcShape]="500"
    (click)="openModal()"></button>
</div>
<app-access-denied *ngIf="!(structureFonctionSrv.resourceName|creable)"></app-access-denied>

<!-- Modal window -->
<nz-modal nzWidth="80%" [(nzVisible)]="isModalVisible" [nzClosable]="false" [nzTitle]="'Fonctions de ' + structure?.nom"
  [nzContent]="modalBody" [nzFooter]="modalFooter" (nzOnCancel)="closeModal()">
  <ng-template #modalBody>
    <form #form="ngForm" ngNativeValidate>
      <div class="row">
        <div class="col-12 col-md-12">
          <tc-form-group>
            <tc-form-label>Fonctions</tc-form-label>
            <nz-select (ngModelChange)="onFonctionSelected($event)" style="width: 100%;"
              (nzOpenChange)="fetchNotBindedFonctions()" nzMode="tags" [nzAllowClear]="true" [nzShowSearch]="true"
              name="fonctions" nzPlaceHolder="Selectionner le(s) fonction(s)" [(ngModel)]="selectedFonctions">
              <ng-container *ngFor="let fonction of fonctions">
                <nz-option *ngIf="!fetching" [nzLabel]="fonction?.nom" [nzValue]="fonction">
                </nz-option>
              </ng-container>
              <nz-option *ngIf="fetching" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> Veuillez patienter...
              </nz-option>
            </nz-select>
          </tc-form-group>
        </div>
      </div>
    </form>

    <tc-table *ngIf="structureFonctions?.length" [itemsPerPage]="10" [rows]="structureFonctions" [hovered]="true" [pagination]="true" [search]="false">
      <tc-table-col [columnTitle]="'Fonction'" [columnName]="'fonction'" [enableSorting]="true">
        <ng-template #tableTDTemplate let-value let-row>
          <i class="icofont-stamp icofont-2x"></i> &nbsp;
          <span class="nowrap">{{ value?.nom }}</span>
        </ng-template>
      </tc-table-col>
      <tc-table-col [columnTitle]="'Etat'" [columnName]="'etat'" [enableSorting]="true">
        <ng-template #tableTDTemplate let-value let-row="row">
          <tc-switcher [(ngModel)]="row.etat" name="etat" id="etat" #etat="ngModel"
            [bgColor]="['transparent', 'transparent', '#ed5564']" [borderColor]="['#ed5564', '#ed5564', '#ed5564']"
            [color]="['#ed5564', '#ed5564', '#fff']">
          </tc-switcher>
        </ng-template>
      </tc-table-col>
    </tc-table>
  </ng-template>

  <ng-template #modalFooter>
    <div class="actions justify-content-between">
      <button beforeIcon="icofont-close" class="pull-right" tc-button [type]="'button'" [view]="'error'"
        (click)="closeModal()">Fermer</button>
      <button [disabled]="form.invalid" [disabled]="form.invalid" (click)="save()" [afterIcon]="'icofont-save'"
        tc-button [view]="'accent'">
        Enregistrer
      </button>
    </div>
  </ng-template>
</nz-modal>
<!-- end Modal window -->